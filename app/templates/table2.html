{% include "header.html" %}

<!-- Page Header -->
<h1>Flask-SocketIO-Chat: {{ room }}</h1>
<h1>Banker</h1>

{% for card in banker %}
<h2>{{ card.symbol }} {{ card.suit }}</h2>
{% endfor %}

{% for player in players %}
<h1>Player {{player.get_name()}}</h1>
<h2>Money {{player.get_money()}}</h2>
<h2>Basic Stake {{player.get_basic_stake()}}</h2>
<h2>Total Stake {{player.get_total_stake()}}</h2>
{% for hand in player.hands %}
{% for card in hand.cards %}
<h2>{{ card.symbol }} {{ card.suit }}</h2>
{% endfor %}
<h2>-------------------------</h2>
{% if player.id == current_user.id and not game_end %}
{% if ask_insurance %}
<h2>Want to buy an insurance?</h2>
<a href="{{ url_for('game_route.insurance',player_id=player.id, answer=1) }}"><h2>Yes</h2></a>
<a href="{{ url_for('game_route.insurance',player_id=player.id, answer=0) }}"><h2>No</h2></a>
{% else %}
{% if player.get_able_double() %}
<a href="{{ url_for('game_route.double',player_id=player.id) }}"><h2>Double</h2></a>
{% endif %}
{% if hand.get_able_split() and not hand.get_is_finish()%}
<a href="{{ url_for('game_route.split',player_id=player.id,hand_id=hand.id) }}"><h2>Split</h2></a>
{% endif %}
{% if hand.get_is_hit() %}
<a href="{{ url_for('game_route.hit',player_id=player.id,hand_id=hand.id) }}"><h2>Hit</h2></a>
{% endif %}
{% if not hand.get_is_finish() %}
<a href="{{ url_for('game_route.stand',player_id=player.id,hand_id=hand.id) }}"><h2>Stand</h2></a>
{% endif %}
{% if player.get_able_fold() %}
<a href="{{ url_for('game_route.fold',player_id=player.id) }}"><h2>Fold</h2></a>
{% endif %}
{% endif %}
{% endif %}
{% endfor %}
{% endfor %}
{% for player in players %}
{% if player.id == current_user.id and game_end %}
<h1>Game is End</h1>
{% for hand in player.hands %}
<h2>{{ hand.result }}</h2>
{% endfor %}
<a href="{{ url_for('game_route.reset') }}">
    <button>Continue</button>
</a>
{% endif %}
{% endfor %}
<textarea id="chat" cols="80" rows="20"></textarea><br><br>
<input id="text" size="80" placeholder="Enter your message here"><br><br>
<a href="{{ url_for('game_route.logout') }}" onclick="leave_room();">
    <button>Leave</button>
</a>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.3/socket.io.js"
        integrity="sha512-iWPnCISAd/J+ZacwV2mbNLCaPGRrRo5OS81lKTVPtRg1wGTC20Cfmp5Us5RcbLv42QLdbAWl0MI57yox5VecQg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" charset="utf-8">
    var socket;
    $(document).ready(function(){
        socket = io.connect('http://' + document.domain + ':' + location.port + '/table')
        socket.on('connect', function() {
            console.log('connect');
            socket.emit('joined', {});
        });

        socket.on('status', function(data) {
            $('#chat').val($('#chat').val() + '<' + data.msg + '>\n');
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
            socket.emit('refresh', {});
        });

        socket.on('message', function(data) {
            $('#chat').val($('#chat').val() + data.msg + '\n');
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });
        socket.on('disconnect', function() {
            console.log('disconnect');
        });

    });
    function leave_room() {
        socket.emit('left', {}, function() {
            socket.disconnect();

            // go back to the login page
            window.location.href = "{{ url_for('game_route.home') }}";
        });
    }
</script>
{% include "footer.html" %}