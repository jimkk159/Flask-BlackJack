{% include "header.html" %}

<div class="page table-page">
    <div class="table-screen container-fluid mx-auto">
        <div class="page-inside table-page-inside row">
            <div class="col-lg-9 table-col-1">
                <div class="px-1 table"
                     style="background-image: url({{ url_for('static',filename='img/blackjack-table.png') }});">
                    <div class="row game-status-row">
                        <div class="row banker-status-row">
                            <div class="player-status-content">
                                {% for player in game.get_players() %}
                                <p class="player-name">Player: <span>{{ player.get_name() }}</span></p>
                                {% endfor %}
                                <p>Total Money: {{ 1000 }}</p>
                                <p>Basic Stake: {{ 5 }}</p>
                                <p>Total Stake: {{ 10 }}</p>
                            </div>
                            <div class="card-content">
                                {% for num in range(banker|length) %}
                                {% if banker[num].get_faced() %}
                                <img class="poker-card"
                                     src="{{ url_for('static',filename='img/poker/'+banker[num].get_suit()+'/'+banker[num].get_img()) }}"
                                     style="left:{{ 40+2*num }}rem;">
                                {% else %}
                                <img class="poker-card"
                                     src="{{ url_for('static',filename='img/poker/poker_back.svg') }}"
                                     style="left:34rem;">
                                {% endif %}
                                {% endfor %}
                            </div>
                            {% if ask_insurance %}
                            <div class="dialog banker-dialog" style="top:1rem;left:23rem;">
                                <div class="row dialog-name">
                                    <div class="leftAlign">
                                        <div class="dialogContainer">
                                            <div class="mainDialog">Dealer</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row dialog-content">
                                    <div class="leftAlign">
                                        <div class="dialogContainer">
                                            <div class="mainDialog">Buy Insurance?<br>
                                                <p>&nbsp
                                                    <a class="insurance-choice"
                                                       href="{{ url_for('game_route.insurance',player_id=0, answer=1) }}">
                                                        Yes
                                                    </a>
                                                    &nbsp &nbsp
                                                    <a class="insurance-choice"
                                                       href="{{ url_for('game_route.insurance',player_id=0, answer=0) }}">
                                                        No
                                                    </a>
                                                </p>
                                            </div>
                                            <img src="{{ url_for('static',filename='img/moreText.gif') }}"
                                                 class="moreTextIcon">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="row player-dialog-row">
                            {% for player in game.get_players() %}
                            {% for hand in player.get_hands() %}
                            {% if hand.get_is_end() %}
                            <div class="dialog" style="left:{{ hand.get_cards()[0].get_x() }}rem;">
                                <div class="row dialog-name">
                                    <div class="leftAlign">
                                        <div class="dialogContainer">
                                            <div class="mainDialog">Player {{ player.get_name() }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row dialog-content">
                                    <div class="leftAlign">
                                        <div class="dialogContainer">
                                            <div class="mainDialog">This hand is {{ hand.get_result() }}<br><br></div>
                                            <img src="{{ url_for('static',filename='img/moreText.gif') }}"
                                                 class="moreTextIcon">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                            {% endfor %}
                        </div>
                        <div class="row player-cards-row">
                            <div class="card-content">
                                {% for player in game.get_players() %}
                                {% for hand in player.get_hands() %}
                                {% for card in hand.get_cards() %}
                                <img class="poker-card"
                                     src="{{ url_for('static',filename='img/poker/'+card.get_suit()+'/'+card.get_img()) }}"
                                     style="left:{{ card.get_x() }}rem;">
                                {% endfor %}
                                {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 table-col-2">
                <div class="table-rule">
                    <div class="dark-background"
                         style=" background-image: url(https://i.ibb.co/nrmkm7d/five-bells-washed-out-logo.png) , linear-gradient(to right, rgba(58, 61, 62, 1) 0%, rgba(58, 61, 62, 1) 100%);">
                        <div class="outer-border">
                            <div class="mid-border">
                                <div class="inner-border">
                                    <img class="corner-decoration corner-left-top"
                                         src="https://i.ibb.co/4mKvK3N/corner-decoration.jpg"></img>
                                    <img class="corner-decoration corner-right-top"
                                         src="https://i.ibb.co/4mKvK3N/corner-decoration.jpg"></img>
                                    <img class="corner-decoration corner-right-bottom"
                                         src="https://i.ibb.co/4mKvK3N/corner-decoration.jpg"></img>
                                    <img class="corner-decoration corner-left-bottom"
                                         src="https://i.ibb.co/4mKvK3N/corner-decoration.jpg"></img>

                                    <!-- Page Content -->
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <h1>Table Rule</h1>
                                            <p>Number of decks: {{ game.get_deck_num() }}</p>
                                            <p>Max Players of Table: {{ game.get_players_num() }}</p>
                                            <p>Minimum Bet: {{ game.get_min_bet() }}</p>
                                            <p>BlackJack Ration: {{ game.get_blackjack_ratio() }}</p>
                                            <p>Insurance: {{ "Open" if game.get_is_insurance() else "Close" }}</p>
                                            <p>Over 10 Insurance: {{ "Open" if game.get_insurance_over_10() else "Close"
                                                }}</p>
                                            <p>Double Down: {{ "Open" if game.get_is_double() else "Close" }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="control-panel container-fluid">
        <div class="row">
            {% for player in game.get_players() %}
            {% for hand in player.hands %}
            <div class="col-lg-9">
                <div class="row">
                    <div class="col-lg-1"></div>
                    <div class="col-lg-2">
                        {% if hand.get_able_hit() %}
                        <a href="#" onclick="hit_click( { hand_id:'{{ hand.id }}' } );">
                            <img class="gestures gestures-hit"
                                 src="{{ url_for('static',filename='img/gestures/gesture-hit-no-bg.png') }}">
                        </a>
                        {% else %}
                        <img class="gestures gestures-hit"
                             src="{{ url_for('static',filename='img/gestures/gesture-hit-no-bg.png') }}"
                             style="filter: grayscale(100%);">
                        {% endif %}
                    </div>
                    <div class="col-lg-2">
                        {% if player.get_able_double() %}
                        <a href="#" onclick="double_click( { player_id:'{{ player.id }}' } );">
                            <img class="gestures gestures-double"
                                 src="{{ url_for('static',filename='img/gestures/gesture-double-no-bg.png') }}">
                        </a>
                        {% else %}
                        <img class="gestures gestures-double"
                             src="{{ url_for('static',filename='img/gestures/gesture-double-no-bg.png') }}"
                             style="filter: grayscale(100%);">
                        {% endif %}
                    </div>
                    <div class="col-lg-2">
                        {% if hand.get_able_split() and not hand.get_is_finish()%}
                        <a href="#" onclick="split_click( { player_id:'{{ player.id }}', hand_id:'{{ hand.id }}' } );">
                            <img class="gestures gestures-split"
                                 src="{{ url_for('static',filename='img/gestures/gesture-split-no-bg.png') }}">
                        </a>
                        {% else %}
                        <img class="gestures gestures-split"
                             src="{{ url_for('static',filename='img/gestures/gesture-split-no-bg.png') }}"
                             style="filter: grayscale(100%);">
                        {% endif %}
                    </div>
                    <div class="col-lg-2">
                        {% if not hand.get_is_finish() %}
                        <a href="#" onclick="stand_click( { hand_id:'{{ hand.id }}' } );">
                            <img class="gestures gestures-stand"
                                 src="{{ url_for('static',filename='img/gestures/gesture-stand-no-bg.png') }}">
                        </a>
                        {% else %}
                        <img class="gestures gestures-stand"
                             src="{{ url_for('static',filename='img/gestures/gesture-stand-no-bg.png') }}"
                             style="filter: grayscale(100%);">
                        {% endif %}
                    </div>
                    <div class="col-lg-2">
                        {% if player.get_able_fold() %}
                        <a href="#" onclick="fold_click( { player_id:'{{ player.id }}' } );">
                            <img class="gestures gestures-surrender"
                                 src="{{ url_for('static',filename='img/gestures/gesture-surrender-no-bg.png') }}">
                        </a>
                        {% else %}
                        <img class="gestures gestures-surrender"
                             src="{{ url_for('static',filename='img/gestures/gesture-surrender-no-bg.png') }}"
                             style="filter: grayscale(100%);">
                        {% endif %}
                    </div>
                    <div class="col-lg-1"></div>
                </div>
            </div>
            {% endfor %}
            {% endfor %}
            <div class="col-lg-3">
                <div class="leave-button">
                    <a href="#" onclick="leave_room();">
                        <button class="btn btn-secondary btn-lg">Leave</button>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.3/socket.io.js"
        integrity="sha512-iWPnCISAd/J+ZacwV2mbNLCaPGRrRo5OS81lKTVPtRg1wGTC20Cfmp5Us5RcbLv42QLdbAWl0MI57yox5VecQg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" charset="utf-8">
    var socket;
    $(document).ready(function(){
        socket = io.connect('http://' + document.domain + ':' + location.port + '/table')
        socket.on('connect', function() {
            console.log('connect');
            socket.emit('joined', {});
        });

        socket.on('disconnect', function() {
            console.log('disconnect');
        });

        socket.on('status', function(data) {
            socket.emit('refresh', {});
        });

        socket.on('message', function(data) {
        });

        socket.on('reload', function(data) {
            location.reload()
        });
    });
    function leave_room() {
        socket.emit('left', {}, function() {
            socket.disconnect();

            // go back to the logout page
            window.location.href = "{{ url_for('game_route.logout') }}";
        });
    }
    function hit_click(data) {
        socket.emit('hit_', data);
    }
    function double_click(data) {
        socket.emit('double_', data);
    }
    function split_click(data) {
        socket.emit('split_', data);
    }
    function stand_click(data) {
        socket.emit('stand_', data);
    }
    function fold_click(data) {
        socket.emit('fold_', data);
    }

</script>
{% include "footer.html" %}